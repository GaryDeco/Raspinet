#!/bin/bash

echo "
Built for 64-bit Raspberry Pi OS...

   ;d0KOd.  .oOK0x:  
 0xlllcoxolkolllloX 
  ;OccloddKNdxdocckc 
   .dkddkWNNMOdoxd,  
   .o:,x0....xd,ck'  
   K:xOoloOOccloocW  
 .x;N:....xO....'K;k,
 O..Nc...:XNl...:X.,X
 .kkx0NXk'...dNNxldK'
  'k...0o....,O...d: 
   ;o;'oM0olkWc.;oc  
     .cOx....dOl.    
        .x00k.  

GNU/Linux aarch64 5.10.92-v8+

"
sleep 3
echo "Note: After configuration is complete, bluetooth and wifi will be disabled

System will auto-reboot at completion...
"
#--- Ensure this is being run as root ---#
if [[ $EUID > 0 ]]
        then echo "Please run this script as root, exiting..."
        sleep 1
        exit
fi

echo "Getting system info..."
#--- Display some system info --#
cat /proc/cpuinfo

echo ""
sleep 1
# give permissions to build script (only write is necessary)
sudo chmod 777 builder # 777 for dev purposes

################################# enable ssh ###################################
# --- check is SSH is enabled, if not, install it. 
if service ssh status | grep -q inactive; then
    echo "Enabling SSH..."
    ssh-keygen -A &&
    update-rc.d ssh enable &&
    invoke-rc.d ssh start 
else
    echo "SSH is already enabled... Moving on"
fi
######################### Disable Wi-Fi and bluetooth #########################
# disable transmisson capability (persists after reboot, reverse with unblock command)
sudo rfkill block wifi && sudo rfkill block bluetooth # disable wifi and disable bluetooth

############################# update and ugrade ################################
#  may disable when stable version is complete
sudo apt-get -y update && sudo apt-get -y upgrade
sudo apt-get -y dist-upgrade 

########################### install dependencies ################################
# basic installs
echo "Installing basic packages..."
sudo apt-get install -y whiptail # menu tool
sudo apt-get install -y figlet # pretty display in CLI
sudo apt-get install -y nmap # scanning the network
sudo apt-get install -y ndiff # comparing scans

# python scripts
#---- For Parsing ----#
sudo pip install argparse
sudo pip install python-libnmap
sleep 1

# more complicated installs

############################## configurations #####################################
# Locale
echo "Updating locale..."
perl -pi -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/g' /etc/locale.gen
echo ""
# wake-switch and LED

# network connection LED

# web server

############################## Link files #####################################
# symlinks

############################## Clean up dirs ##################################
# remove unecessary stuff #TODO fix this with if statement 
# TODO check behavior for if files do not exist
sudo rm -rf Bookshelf/
sudo rm -rf Documents/
sudo rm -rf Downloads/
sudo rm -rf Music/
sudo rm -rf Pictures/
sudo rm -rf Public/
sudo rm -rf Templates/
sudo rm -rf Videos/
echo " Cleaned out some junk..."
############################## Add dirs ##################################
# make sure we are in the right dir #TODO combine and simplfy
echo "Adding some directories..."
sudo mkdir -p raspinet/bin && 
sudo mkdir raspinet/discovery &&
sudo mkdir raspinet/discovery/hosts && 
sudo mkdir raspinet/discovery/ports &&
sudo mkdir raspinet/discovery/services
sudo chmod 777 raspinet &&
sudo chmod 777 raspinet/bin &&
sudo chmod 777 raspinet/discovery &&
sudo chmod 777 raspinet/discovery/hosts &&
sudo chmod 777 raspinet/discovery/ports &&
sudo chmod 777 raspinet/discovery/services

echo "Getting some scripts..."
# bin folder
sudo wget https://raw.githubusercontent.com/GaryDeco/Raspinet/main/raspinet/bin/filemanager
sleep 1
sudo wget https://raw.githubusercontent.com/GaryDeco/Raspinet/main/raspinet/bin/linker
sleep 1
sudo wget https://raw.githubusercontent.com/GaryDeco/Raspinet/main/raspinet/bin/piscan.sh
sleep 1
echo "Raspinet scripts installed..."
sleep 1
echo "Relocating files..."
# move files and give permissions
sudo mv filemanager raspinet/bin/
sudo chmod 777 raspinet/bin/filemanager
sudo mv linker raspinet/bin/
sudo chmod 777 raspinet/bin/linker
sudo mv piscan.sh raspinet/bin/
sudo chmod 777 raspinet/bin/piscan.sh
sleep 1
echo "Files relocated..."
sleep 1
# discovery folder

#TODO Add scripts

echo "Done"
sleep 1

############################### End of Config ##################################
# final house keeping
echo "Covering tracks..."
sudo rm builder
sleep 1
echo ""
echo "Done"
# reboot the system
echo ""
echo "Installation complete..."
sleep 1
echo "Rebooting..."
sleep 2
sudo reboot
